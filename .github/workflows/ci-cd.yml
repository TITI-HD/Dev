name: Supervision WordPress.com

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

env:
  SITE_URL: "https://oupssecuretest.wordpress.com"

jobs:
  monitor:
    runs-on: ubuntu-latest
    steps:
      - name: Vérifier disponibilité du site
        run: curl -I -f $SITE_URL

      - name: Installer WPScan et scanner le site
        env:
          WPSCAN_API: ${{ secrets.WPSCAN_API }}
        run: |
          gem install wpscan --user-install
          export PATH="$HOME/.local/share/gem/ruby/3.0.0/bin:$HOME/.gem/ruby/3.0.0/bin:$HOME/.gem/ruby/3.1.0/bin:$HOME/.gem/ruby/3.2.0/bin:$PATH"
          wpscan --url $SITE_URL --api-token $WPSCAN_API --disable-tls-checks