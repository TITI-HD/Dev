# .github/workflows/test.yml
name: ğŸ§ª Tests Complets

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  security-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: ğŸ”’ Scan de sÃ©curitÃ© Bandit
        run: |
          pip install bandit
          bandit -r . -f html -o security-report.html
      - name: ğŸ“Š Upload security report
        uses: actions/upload-artifact@v3
        with:
          name: security-report
          path: security-report.html

  unit-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: ğŸ Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: ğŸ“¦ Install dependencies
        run: pip install -r requirements.txt
      - name: ğŸ§ª Run unit tests
        run: python -m unittest test_monitor.py

  integration-test:
    runs-on: ubuntu-latest
    needs: unit-tests
    steps:
      - uses: actions/checkout@v3
      - name: ğŸ Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: ğŸ“¦ Install dependencies
        run: pip install -r requirements.txt
      - name: ğŸ§ª Test d'intÃ©gration monitor
        env:
          SITE_URL: "https://httpbin.org/status/200"
          ALERT_EMAIL: "test@example.com"
        run: |
          # Test avec un site valide
          python monitor.py
          echo "Integration test completed"

  backup-restore-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: ğŸ Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: ğŸ“¦ Install dependencies
        run: pip install -r requirements.txt
      - name: ğŸ’¾ Test de sauvegarde
        run: |
          mkdir -p test-backups
          python -c "
          import monitor
          monitor.BACKUP_DIR = 'test-backups'
          monitor.SITE_URL = 'https://httpbin.org/html'
          monitor.backup_and_monitor()
          "
      - name: ğŸ” VÃ©rification des sauvegardes
        run: |
          echo "Fichiers de sauvegarde crÃ©Ã©s:"
          ls -la test-backups/
          count=$(ls test-backups/ | wc -l)
          if [ $count -gt 0 ]; then
            echo "âœ… Test de sauvegarde rÃ©ussi"
          else
            echo "âŒ Ã‰chec du test de sauvegarde"
            exit 1
          fi